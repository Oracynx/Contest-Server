<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>后台管理系统</title>
    <link rel="stylesheet" href="./css/style.css">
    <script src="./js/admin.js" defer></script>
</head>

<body>

    <div class="container" style="max-width: 800px;">
        <h2>后台管理面板</h2>

        <!-- 1. API Key 设置 -->
        <div style="margin-bottom: 20px;">
            <p>请先验证管理员身份：</p>
            <div class="input-group">
                <input id="api-key-input" type="password" placeholder="请输入 Admin API Key">
                <button id="save-key-btn">保存并连接</button>
            </div>
        </div>

        <div class="section-divider"></div>

        <!-- 2. 全局控制 (设置默认作品) -->
        <h3>全局控制</h3>
        <div id="control-panel">
            <p style="font-size: 0.9rem; color: #666; margin-bottom: 5px;">设置当前全员投票的默认作品：</p>
            <div id="work-select-container">
                <!-- JS 将在这里动态插入 select-wrapper -->
                <p>正在加载作品列表...</p>
            </div>
            <button id="set-default-btn">广播切换命令</button>
        </div>

        <div class="section-divider"></div>

        <h3>批量导入</h3>

        <div class="file-upload-group">
            <!-- [修改] 更新提示文案 -->
            <p><strong>批量创建用户 (.txt)</strong><br>格式: <code style="background:#ddd;padding:2px;">用户名,密码,权重</code> (一行一个，权重缺省为1)</p>
            <div class="input-group">
                <input type="file" id="batch-users-file" accept=".txt">
                <button id="batch-users-btn">上传并创建</button>
            </div>
        </div>

        <div class="section-divider"></div>

        <h3>作品图片管理</h3>
        <div class="file-upload-group">
            <p>为作品上传封面图（将保存为 PNG 格式）：</p>
        
            <!-- 这里复用 select-wrapper 的样式 -->
            <div id="img-upload-select-container" style="margin-bottom: 10px;">
                <select id="img-work-select" class="input-group"
                    style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ddd;">
                    <option value="">加载中...</option>
                </select>
            </div>
        
            <div class="input-group">
                <input type="file" id="work-image-file" accept="image/*">
                <button id="upload-img-btn">上传封面</button>
            </div>
        </div>
        
        <div class="section-divider"></div>

        <h3>手动添加</h3>
        <div class="input-group">
            <input id="new-username" placeholder="用户名">
            <input id="new-password" placeholder="密码">
            <!-- [新增] 权重输入框 -->
            <input id="new-weight" type="number" placeholder="权重" value="1" style="width: 80px;">
            <button id="add-user-btn">注册用户</button>
            </div>
            <div class="input-group">
                <input id="new-workname" placeholder="作品名称">
                <button id="add-work-btn">添加作品</button>
            </div>
            
            <div class="section-divider"></div>
        <!-- [新增] 单项管理区域 -->
        <h3>单项管理 (通过 ID 删除)</h3>
        <p style="font-size: 0.8rem; color: #666;">请先点击下方“列出”按钮获取 ID，复制后填入框中删除。</p>
        <div class="input-group">
            <input id="target-user-id" placeholder="User ID (例如: 019...)">
            <button id="del-single-user-btn" style="background-color: #e74c3c; color: white;">删除该用户</button>
        </div>
        <div class="input-group" style="margin-top: 10px;">
            <input id="target-work-id" placeholder="Work ID (例如: 019...)">
            <button id="del-single-work-btn" style="background-color: #e74c3c; color: white;">删除该作品</button>
        </div>


        <!-- 5. 数据查询 -->
        <h3>数据查询</h3>
        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
            <button id="list-users-btn" style="flex: 1;">列出用户</button>
            <button id="list-works-btn" style="flex: 1;">列出作品</button>
            <button id="list-votes-btn" style="flex: 1;">列出投票</button>
            <button id="list-msgs-btn" style="flex: 1;">列出留言</button>
        </div>
        <div id="log-output">系统就绪...等待操作。</div>

        <div class="section-divider"></div>

        <!-- 6. 危险区域 -->
        <h3 style="color: #c0392b;">危险区域 (慎用)</h3>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
            <button id="del-users-btn" class="btn-danger">清空所有用户</button>
            <button id="del-works-btn" class="btn-danger">清空所有作品</button>
            <button id="del-votes-btn" class="btn-danger">清空所有投票</button>
            <button id="del-msgs-btn" class="btn-danger">清空所有留言</button>
        </div>

        <div style="margin-top: 30px;">
            <a href="/">返回首页</a>
        </div>
    </div>

</body>

</html>